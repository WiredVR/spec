# Search and Discovery

Clients that implement the Wired protocol are free to use any method in order to discover instances to join, but it is typically useful to have a in-game way to discover and access new worlds and instances.

This standard describes the behavior and endpoints that a "discovery service" must implement for players to discover and access different worlds. The following is a list of the required endpoints that must be implemented for the discovery service:

## 1.1 Client-Side Endpoints

### 1.1.1 World List Endpoint

`GET /worlds/{page}`: This endpoint will return a list of worlds, including their URLs and associated metadata such as the name, description, and creator of the world. The data will be returned in JSON format, with each world represented as an object.

### 1.1.2 World Search Endpoint

`GET /worlds/search?q={query}`: This endpoint will search for worlds matching the specified query. The query parameter q will contain the search string. The search results will be returned in JSON format, with each world represented as an object.

## 1.2 Endpoints for Creators

### Permissions

If a endpoint is privileged, then the following applies to the request:

The request **MUST** include an Authorization header containing the user's DID.

The request also **MUST** include a Signature header containing a signature of the JSON body, signed with the user's private key, with the `keyId` of `"did"`
Example:

```
Signature: keyId="did", algorithm="ed25519",signature="LS0tLS1CRUdJTiBTU0ggU0lHTkFUVVJFLS0tLS0KVTFOSVUwbEhBQUFBQVFBQUFETUFBQUFMYzNOb0xXVmtNalUxTVRrQUFBQWcwSS9vQmNCYkwzT0RuVFNpWGFabzBWWWxEUwpHK0Z5YkJkMEIrSXhIUU1NUUFBQUFFWm1sc1pRQUFBQUFBQUFBR2MyaGhOVEV5QUFBQVV3QUFBQXR6YzJndFpXUXlOVFV4Ck9RQUFBRUNvQ2JOSjJtdU9heE1iMkY3bTBtQmRiU1JEU3RaVHpGVElPc0MrdmNzajRyazFFb2JOUDJ4K2c0ODhNbGRkb2cKL3Y4M3NuLzNUQndnaElNOGx4V1M0SwotLS0tLUVORCBTU0ggU0lHTkFUVVJFLS0tLS0="
```

The server **MUST** use this signature to verify whether the requester has the required permissions to modify a given world.

### 1.2.1 Create World

`POST /worlds`: This endpoint will allow players to publish new worlds.

The server will read the `bundle_url` field, download it, and then access its metadata stored inside of the content bundle's `world.json` file. This serves to verify that the content bundle submitted is a valid world file, and prevents non-world submissions.

The request **MUST** include an Authorization header containing the user's DID. This will later be used to update and delete worlds.

#### Request Body

The request body **MUST** provide a `bundle_url` property, pointing to a **resolvable** world bundle to be published.

```json
{
  "bundle_url": "ipfs://Qme7ss3ARVgxv6rXqVPiikMJ8u2NLgmgszg13pYrDKEoiu"
}
```

#### Error Responses

- `401 Unauthorized`: Your authorization is invalid, or you are not permitted to publish this world.
- `400 Bad Request`: The `bundle_url` does not point to a valid world bundle.

#### Success Response

- `200 OK`: The request was successful and the world information is returned in the response body.

Response Body

The response **MUST** provide a `world_id` field, pointing to a stable ID that was generated by the discovery service.

```json
{
  "world_id": "123214782163912837912"
}
```

### 1.2.2 Update World

This is a [Privileged Endpoint](#permissions).

`PATCH /worlds/{world_id}`: This endpoint will allow the owner to update an existing world. The ID of the world is passed as a path parameter. The updated information should be included in the request body in JSON format.

#### Request Body

The request body **MUST** provide a new bundle URL for the new updated version of the world.

```json
{
  "bundle_url": "ipfs://Qme7ss3ARVgxv6rXqVPiikMJ8u2NLgmgszg13pYrDKEoiu"
}
```

#### Error Responses

- `401 Unauthorized`: Your authorization is invalid.
- `403 Forbidden`: You do not have permission to update this world.
- `400 Bad Request`: The `bundle_url` does not point to a valid world bundle.

#### Success Response

- `200 OK`: The request was successful and the world information is returned in the response body.

Response Body

The response **MUST** provide all of the "info" fields of the world after the update.

```json
{
  "schema_version": "1.0",
  "name": "The Longest Night",
  "description": "Lone star shining bright. Forgotten memories arise. New path now in sight"
}
```

### 1.2.2 Delete World

This is a [Privileged Endpoint](#permissions).

`DELETE /worlds/{world_id}`: This endpoint will allow the creator to delete a world they own. The ID of the world is passed as a path parameter.

#### Request Body

No request body is required.

#### Error Responses

- `401 Unauthorized`: Your authorization is invalid.
- `403 Forbidden`: You do not have permission to delete this world.

#### Success Response

- `200 OK`: The request was successful and the world is deleted from the discovery service.

Response Body

No content should be returned in the response body.
